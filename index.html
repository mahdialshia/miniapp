<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Processor Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app-container">
        <h1>Welcome to Mini App!</h1>
        
        <p id="info-message">Loading...</p>

        <div id="options-panel">
            <label for="quality-setting">Choose Quality:</label>
            <select id="quality-setting">
                <option value="low">Low Quality</option>
                <option value="medium" selected>Medium Quality</option>
                <option value="high">High Quality</option>
            </select>
        </div>

        <button id="process-button">ğŸš€ Start Processing</button>
    </div>

    <script>
        let currentPhotoId = null;
        let currentAction = null;

        function initWebApp() {
            Telegram.WebApp.ready();
            
            const urlParams = new URLSearchParams(window.location.search);
            currentPhotoId = urlParams.get('id');
            currentAction = urlParams.get('action');

            if (currentPhotoId && currentAction) {
                document.getElementById('info-message').innerHTML = 
                    `You selected **${currentAction}** for image ID: <span class="id-text">${currentPhotoId.substring(0, 10)}...</span>`;
            } else {
                document.getElementById('info-message').textContent = "Error: Missing image ID or action.";
            }

            // 1. Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø´Ø§Ø´Ø© 
            document.getElementById('process-button').onclick = () => {
                // Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ù€ Debugging: Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø²Ø± ÙŠØ¹Ù…Ù„
                alert("Processing button clicked! Attempting to send data...");
                sendProcessRequest();
            };
            
            // 2. Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø§Ù„Ø³ÙÙ„ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø§Ù„Ø£ÙƒØ«Ø± Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©)
            Telegram.WebApp.MainButton.setText("Confirm & Process").show();
            Telegram.WebApp.MainButton.onClick(sendProcessRequest);
        }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function sendProcessRequest() {
            if (!currentPhotoId || !currentAction) {
                alert("Cannot process without image data. Closing app.");
                Telegram.WebApp.close(); 
                return;
            }

            const setting = document.getElementById('quality-setting').value;
            
            const dataToSend = {
                id: currentPhotoId,
                action: currentAction,
                setting: setting
            };

            const jsonString = JSON.stringify(dataToSend);
            
            // ğŸš¨ Ù‡Ù†Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
            Telegram.WebApp.sendData(jsonString); 
        }

        initWebApp();
    </script>
</body>
</html>
