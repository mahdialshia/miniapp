<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Processor Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app-container">
        <h1>Welcome to Mini App!</h1>
        
        <p id="info-message">Loading...</p>

        <div id="options-panel">
            <label for="quality-setting">Choose Quality:</label>
            <select id="quality-setting">
                <option value="low">Low Quality</option>
                <option value="medium" selected>Medium Quality</option>
                <option value="high">High Quality</option>
            </select>
        </div>

        <button id="process-button">ğŸš€ Start Processing</button>
    </div>

    <script>
        // Ø¯Ø§Ù„Ø© ÙŠØªÙ… ØªÙ†ÙÙŠØ°Ù‡Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        function initWebApp() {
            // Ø¬Ø¹Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø§Ù‡Ø²Ù‹Ø§
            Telegram.WebApp.ready();
            
            // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© Ù…Ù† Ø§Ù„Ø¨ÙˆØª ÙÙŠ Ø§Ù„Ù€ URL
            const urlParams = new URLSearchParams(window.location.search);
            const photoId = urlParams.get('id');
            const action = urlParams.get('action');

            if (photoId && action) {
                // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                document.getElementById('info-message').innerHTML = 
                    `You selected **${action}** for image ID: <span class="id-text">${photoId.substring(0, 10)}...</span>`;
            } else {
                document.getElementById('info-message').textContent = "Error: Missing image ID or action.";
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø²Ø± Ø¨Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            document.getElementById('process-button').onclick = () => sendProcessRequest(photoId, action);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙÙŠ Ø´Ø±ÙŠØ· ØªÙ„ÙŠØ¬Ø±Ø§Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            Telegram.WebApp.MainButton.setText("Confirm & Process").show();
            Telegram.WebApp.MainButton.onClick(() => sendProcessRequest(photoId, action));
        }

        // Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª ÙˆØ¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
        function sendProcessRequest(photoId, action) {
            if (!photoId || !action) {
                alert("Cannot process without image data.");
                return;
            }

            const setting = document.getElementById('quality-setting').value;
            
            const dataToSend = {
                id: photoId,
                action: action,
                setting: setting
            };

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ€ JSON String Ø¥Ù„Ù‰ Ø§Ù„Ø¨ÙˆØª
            const jsonString = JSON.stringify(dataToSend);
            
            // Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© ØªØ±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØºÙ„Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ØµØºØ±
            Telegram.WebApp.sendData(jsonString); 
        }

        initWebApp();
    </script>
</body>
</html>